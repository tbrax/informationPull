


<script type=text/javascript>
    $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
  </script>

<script type=text/javascript src="{{
    url_for('static', filename='jquery.js') }}">
</script>
<link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
<script type=text/javascript>


class LoadedArticle {
  constructor() {
    this.sentenceConstruction = [];
    this.name = "";
    this.sentence = "";
  }
  addPatterns()
  {

  }
}

let currentArt = new LoadedArticle();

function seperateTextBySentences(text)
{
    var result = text.match( /[^\.!\?]+[\.!\?]+/g );
    return result
}

function displayArticlePatterns(sentenceList)
{

}

function getArticlePatterns(articleName)
{

    $.getJSON($SCRIPT_ROOT + '/ajaxReturnPatterns',
                {async: false,
                valArticleName: articleName
                },
                function(data) 
                {
                    //splitSentence(data.result);
                });
}

function getStructure(sentence)
{

    $.getJSON($SCRIPT_ROOT + '/ajaxAnalyzeRegex',
                {async: false,
                valSentenceToAnalyze: sentence
                },
                function(data) 
                {
                    splitSentence(data.result);
                });
}

function displaySentence(sentence)
{
    var sen = document.getElementById("selectedSentence");
    removeChildren(sen);
    var anchor = document.createElement("a");
    anchor.innerHTML = sentence;
    sen.appendChild(anchor);
}

function removeChildren(element)
{
    while (element.firstChild) 
    {
        element.removeChild(element.firstChild);
    }
}


function resetConstructionImage()
{
    var sen = document.getElementById("constructedSentence");
    removeChildren(sen);
    var sen1 = document.getElementById("constructedGrammar");
    removeChildren(sen1);
}
function resetConstruction()
{
    currentArt.sentenceConstruction = [];
    resetConstructionImage();
    
}

function updateConstruction(c)
{
    resetConstructionImage();
    var sen0 = document.getElementById("constructedSentence");
    var sen1 = document.getElementById("constructedGrammar");
    for (let i in c)
    {               
        var btn0 = document.createElement("button");
            btn0.innerHTML = c[i][0];
            btn0.className = "fixedbtn";
        var btn1 = document.createElement("button");
            btn1.innerHTML = c[i][1];
            btn1.className = "fixedbtn";
        sen0.appendChild(btn0);
        sen1.appendChild(btn1);
    }
}
function addWholeConstruction(sentence)
{
    for(let i in sentence)
    {
        addWordToConstruction(sentence[i][0],sentence[i][1])
    }
}

function addWordToConstruction(word,grammar,index)
{
    currentArt.sentenceConstruction.push([word,grammar,index]);
    updateConstruction(currentArt.sentenceConstruction);
    //console.log(sentenceConstruction);
}


function getColumn(array,col)
{
    temp = []
    for (var x in array)
    {
        temp.push(array[x][col])
    }
    return temp
}

function arrayToString(arr)
{
    temp = []
    for (var x in arr)
    {
        temp.push(arr[x])
    }
    return temp
}
function savePattern()
{
    //var sendP = getColumn(currentArt.sentenceConstruction,1);
    //var sendS = getColumn(currentArt.sentence,1); 
    var sendP = currentArt.sentenceConstruction;
    var sendS = currentArt.sentence;
    //console.log(sendP);
    //console.log(sendS);


    $.ajax({
    url: $SCRIPT_ROOT + '/ajaxSavePattern',
    data: { valPattern: sendP, valSentence: sendS },
    traditional: true,
    success: function(result) {

    }
});

}



function splitSentence(sentence)
{
    currentArt.sentence = sentence
    var sen0 = document.getElementById("selectedSentence");
    removeChildren(sen0);
    var sen1 = document.getElementById("selectedGrammar");
    removeChildren(sen1);
    var sen2 = document.getElementById("otherButtons");
    removeChildren(sen2);
    var anchor = document.createElement("a");
    var anchor1 = document.createElement("a");

    var btnWhole = document.createElement("button");
        btnWhole.innerHTML = "Add All Words";
        btnWhole.addEventListener("click", function()
        {
            addWholeConstruction(sentence)
        });
        var btnWhole = document.createElement("button");
        btnWhole.innerHTML = "Save Pattern";
        btnWhole.addEventListener("click", function()
        {
            savePattern()
        });

    sen2.appendChild(btnWhole);
    //console.log(sentence);
    //(sentence)
    //var words = sentence.split(" ");
    for (let i in sentence) 
    {
        let val0 = sentence[i][0];
        let val1 = sentence[i][1];
        var btn = document.createElement("button");
        btn.innerHTML = val0;
        btn.className = "fixedbtn";
        
        anchor.appendChild(btn);



        var btn2 = document.createElement("button");
        btn2.className = "fixedbtn";
        //console.log(paddedValue);
        btn2.innerHTML = val1;
        anchor1.appendChild(btn2);

        btn.addEventListener("click", function()
        {
            addWordToConstruction(val0,val1,i)
        }); 

        btn2.addEventListener("click", function()
        {
            addWordToConstruction(val0,val1,i)
        }); 

    }
    sen0.appendChild(anchor);
    sen1.appendChild(anchor1);
}

function selectSentence(sentence)
{
    
    //displaySentence(sentence);
    getStructure(sentence);
    //displaySentence(sentence);
    //document.getElementById("selectedSentence").textContent = sentence; 
    //console.log(sentence);
}

function displayPatternMatches(result)
{
    console.log(result)
}

function checkPatterns()
{
    $.getJSON($SCRIPT_ROOT + '/ajaxReturnPatterns',
                {
                valArticle: currentArt.name
                },
                function(data) 
                {
                    
                    displayPatternMatches(data.result);
                });
}

function displayDocument(result)
{
    currentArt.name = result[0]
    strs = result[1]
    //console.log(result);
    //var list = document.createElement("ul");
    //strs = seperateTextBySentences(result)
    var patternButtonSpan = document.getElementById("checkPatternSpan");

    removeChildren(patternButtonSpan);
    var btnPattern = document.createElement("button");
        btnPattern.innerHTML = "Check Patterns";
        btnPattern.addEventListener("click", function()
        {
            checkPatterns();
        }); 
    patternButtonSpan.appendChild(btnPattern);

    var list = document.getElementById("listAnchor");
    removeChildren(list);
    
    for (let i in strs) 
    {
        var anchor = document.createElement("a");
        anchor.href = "#";
        anchor.innerText = strs[i];
        anchor.id = "articleSentence" + i;
        anchor.addEventListener("click", function()
        {
            selectSentence(strs[i]);
        }); 
        /*
        anchor.onclick = function () 
        {
            var thisName = this.id;
            var res = thisName.split("articleSentence")[1];
            var resNum = parseInt(res);
            selectSentence(strs[resNum]);
        };*/

        var elem = document.createElement("li");
        elem.appendChild(anchor);
        list.appendChild(elem);
    }
}
    $(function() 
    {
      $('a#calculate').bind('click', function() 
      {
        $.getJSON($SCRIPT_ROOT + '/ajaxGetArticle', 
        {
          valArticle: $('input[name="article"]').val()
        }, function(data) 
        {
          //$("#resultArticle").text(data.result);
          displayDocument(data.result);
        });
        
        return false;
      });

      $('a#calcAnalyzeRegex').bind('click', function() 
      {
        $.getJSON($SCRIPT_ROOT + '/ajaxAnalyzeRegex', 
        {
          valSentenceToAnalyze: $('textArea[name="analyzeRegex"]').val()
        }, function(data) 
        {
          $("#resultAnalyzeRegex").text(data.result);
        });
        return false;
      });
    });
  </script>
    <p>
        <input type=text size=10 name=article>
        <a href=# id=calculate>Get Article</a>
    </p>
    <p>
        <span id="checkPatternSpan"> </span>      
    </p>
    
    <!--<p>
        <textarea size=25 name=analyzeRegex cols="30" rows="5"></textarea>
        <a href=# id=calcAnalyzeRegex>Analyze Regex</a>
    </p>-->
    <button type="button" onclick="resetConstruction()">Reset Sentence</button> 
    <p>
        <span id="constructedSentence"> </span>      
    </p>
    <p>
        <span id="constructedGrammar"> </span>      
    </p>
    <hr>
    <p>
        <span id="otherButtons"> </span>
    </p>
    <p>
        <span id="selectedSentence"> </span>
    </p>
    <p>
        <span id="selectedGrammar"> </span>
    </p>
    
    <p>
        <span id=resultAnalyzeRegex></span>
    </p>
    <hr>
    <p>
        <ul id=listAnchor></ul>
    </p>
    
    <p>
        <p id=resultArticle></p>
    </p>
    

<script>

    window.onload = (event) => 
    {   
    };


    function clickCookie0()
    {
        //setCookie("PageCookie0", document.getElementById("inputBox0").value,"100" );
    }


</script>

